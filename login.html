<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PLANEAT · 로그인</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    /* === 로그인 페이지 전용 최소 CSS (충돌 없이 동작) === */
    body.auth-bg{background:#f7f3ef;}
    .auth-shell{min-height:100vh;display:grid;place-items:center;padding:24px;}
    .auth-card{width:min(420px,92vw);background:#fff;border:1px solid #e9e2d9;border-radius:16px;
               box-shadow:0 12px 28px rgba(0,0,0,.06);padding:20px 22px;}
    .auth-head{margin-bottom:10px}
    .brand{margin:0;font-size:22px;letter-spacing:.5px}
    .brand-sub{margin:6px 0 0;color:#8a8178;font-size:12px}
    .field{display:flex;flex-direction:column;gap:6px;margin:10px 0}
    .field>label{font-size:12px;color:#6f665e}
    .field>input{height:40px;border:1px solid #e7ded4;border-radius:10px;padding:0 12px;outline:none}
    .field>input:focus{border-color:#bfa68a;box-shadow:0 0 0 3px rgba(191,166,138,.18)}
    .actions .btn{height:42px;border-radius:12px;border:1px solid #111;background:#111;color:#fff;width:100%;font-weight:700}
    .aux-row{margin-top:8px;font-size:11px;display:flex;gap:6px;align-items:center}
    .aux-row.center{justify-content:center}
    .tiny-link{color:#2463eb;text-decoration:underline;cursor:pointer}
    .sep{color:#c0b6ad}
    /* 보이기/숨기기 제어 */
    [data-view]{display:none}
    [data-view].active{display:block}
  </style>
</head>
<body class="auth-bg">
  <main class="auth-shell">
    <section class="auth-card">
      <header class="auth-head">
        <h1 class="brand">PLANEAT</h1>
        <p class="brand-sub">맛집 플래너 로그인</p>
      </header>

      <div id="authViews">
        <!-- LOGIN -->
        <form id="loginForm" class="auth-form" data-view="login">
          <div class="field">
            <label>아이디</label>
            <input id="liId" type="text" autocomplete="username" required />
          </div>
          <div class="field">
            <label>비밀번호</label>
            <input id="liPw" type="password" autocomplete="current-password" required />
          </div>
          <div class="field actions">
            <button class="btn" type="submit">로그인</button>
          </div>
          <div class="aux-row">
            <a class="tiny-link" href="#signup">회원가입</a><span class="sep">·</span>
            <a class="tiny-link" href="#find">비밀번호 찾기</a>
          </div>
        </form>

        <!-- SIGNUP -->
        <form id="signupForm" class="auth-form" data-view="signup">
          <div class="field">
            <label>실명</label>
            <input id="suName" type="text" required />
          </div>
          <div class="field">
            <label>아이디</label>
            <input id="suId" type="text" autocomplete="username" required />
          </div>
          <div class="field">
            <label>비밀번호</label>
            <input id="suPw" type="password" autocomplete="new-password" minlength="8" required />
          </div>
          <div class="field actions">
            <button class="btn" type="submit">가입하기</button>
          </div>
          <div class="aux-row center">
            <a class="tiny-link" href="#login">로그인으로 돌아가기</a>
          </div>
        </form>

        <!-- FIND (ID+실명) -->
        <form id="findForm" class="auth-form" data-view="find">
          <div class="field">
            <label>아이디</label>
            <input id="fpId" type="text" required />
          </div>
          <div class="field">
            <label>실명</label>
            <input id="fpName" type="text" required />
          </div>
          <div class="field">
            <label>새 비밀번호</label>
            <input id="fpNew" type="password" minlength="8" required />
          </div>
          <div class="field actions">
            <button class="btn" type="submit">비밀번호 재설정</button>
          </div>
          <div class="aux-row center">
            <a class="tiny-link" href="#login">로그인으로 돌아가기</a>
          </div>
        </form>
      </div>
    </section>
  </main>

  <!-- 반드시 auth.js 먼저 -->
  <script src="auth.js"></script>
  <script>
    // 보이기/숨기기: 기본은 login만 active
    function setActive(view){
      document.querySelectorAll('[data-view]').forEach(el=>{
        el.classList.toggle('active', el.getAttribute('data-view')===view);
      });
    }
    function route(){
      const v = (location.hash || '#login').slice(1);
      setActive(['login','signup','find'].includes(v) ? v : 'login');
    }
    // 이미 로그인되어 있으면 메인으로
    function guard(){
      try{
        const me = window.auth && window.auth.getProfile && window.auth.getProfile();
        if (me) { location.href = 'index.html'; }
      }catch{}
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      guard();
      route();
      window.addEventListener('hashchange', route);

      // 로그인
      document.getElementById('loginForm').addEventListener('submit', (e)=>{
        e.preventDefault();
        const id = document.getElementById('liId').value.trim();
        const pw = document.getElementById('liPw').value.trim();
        const ok = window.auth && window.auth.login && window.auth.login(id, pw);
        if (ok===true) {
          location.href = 'index.html';
        } else if (ok && ok.success===true) { // 어떤 구현이든 성공이면 이동
          location.href = 'index.html';
        } else {
          alert((ok && ok.message) || '아이디/비밀번호를 확인하세요.');
        }
      });

      // 회원가입
      document.getElementById('signupForm').addEventListener('submit', (e)=>{
        e.preventDefault();
        const realName = document.getElementById('suName').value.trim();
        const id = document.getElementById('suId').value.trim();
        const pw = document.getElementById('suPw').value.trim();
        const res = window.auth && window.auth.signup
          ? window.auth.signup({ id, password: pw, realName })
          : { success:false, message:'auth.signup 미탑재' };
        if (!res || res.success===false) return alert(res.message||'회원가입 실패');
        alert('가입 완료! 로그인해주세요.');
        location.hash = '#login';
        e.target.reset();
      });

      // 비밀번호 재설정 (가능한 함수 자동 탐지)
      document.getElementById('findForm').addEventListener('submit', (e)=>{
        e.preventDefault();
        const id   = document.getElementById('fpId').value.trim();
        const name = document.getElementById('fpName').value.trim();
        const npw  = document.getElementById('fpNew').value.trim();

        let res = { success:false, message:'지원 함수 없음' };
        if (window.auth && typeof window.auth.resetPasswordByIdName === 'function') {
          res = window.auth.resetPasswordByIdName({ id, realName:name, newPassword:npw });
        } else if (window.auth && typeof window.auth.resetPasswordByHints === 'function') {
          // 네가 올린 구버전(auth.js)이면 힌트 기반만 지원 → 안내 후 실패 처리
          alert('현재 auth.js는 "별명+실명+메모" 방식만 지원합니다.\n(아이디+실명 방식은 auth.js 업데이트 필요)');
          return;
        }

        if (!res || res.success===false) return alert(res.message||'재설정 실패');
        alert('비밀번호가 변경되었습니다. 새 비밀번호로 로그인하세요.');
        location.hash = '#login';
        e.target.reset();
      });
    });
  </script>
</body>
</html>
