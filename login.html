<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PLANEAT • 로그인</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body class="login-body">
  <main class="auth-wrap">
    <section class="auth-card">
      <h1 class="auth-title">PLANEAT</h1>
      <p class="auth-sub">맛집 인플루언서용 캘린더 & 메모</p>

      <label class="auth-label" for="loginUsername">사용자 이름</label>
      <input id="loginUsername" class="auth-input" type="text" placeholder="예: jinah_23" autocomplete="username" />

      <div class="auth-actions-row">
        <button id="doSignup" class="btn primary" type="button">회원가입</button>
        <button id="doLogin" class="btn" type="button">로그인</button>
      </div>

      <p class="auth-hint">이름만으로 간단 인증합니다. 같은 이름으로 접속하면 동일한 데이터 공간을 사용해요.</p>
    </section>
  </main>

  <script>
    (function(){
      const APP_PREFIX = 'planeat';
      const $ = (s,p=document)=>p.querySelector(s);

      const usernameInput = $('#loginUsername');
      const doSignup = $('#doSignup');
      const doLogin  = $('#doLogin');

      function setCurrentUser(name){
        localStorage.setItem(`${APP_PREFIX}:currentUser`, name);
      }
      function saveUserProfile(name){
        const key = `${APP_PREFIX}:user:${name}:profile`;
        if(!localStorage.getItem(key)){
          localStorage.setItem(key, JSON.stringify({ username:name, createdAt: Date.now() }));
        }
      }
      function goHome(){ window.location.href = 'index.html'; }

      function validateName(raw){
        const v = String(raw||'').trim();
        if(!v) return null;
        // 공백만 금지, 너무 긴 이름 방지
        if(v.length > 40) return null;
        return v;
      }

      doSignup.addEventListener('click', ()=>{
        const name = validateName(usernameInput.value);
        if(!name){ alert('사용자 이름을 올바르게 입력하세요.'); return; }
        saveUserProfile(name);
        setCurrentUser(name);
        goHome();
      });

      doLogin.addEventListener('click', ()=>{
        const name = validateName(usernameInput.value);
        if(!name){ alert('사용자 이름을 올바르게 입력하세요.'); return; }
        // 존재여부와 관계없이 이름으로 인증(간편 로그인)
        setCurrentUser(name);
        goHome();
      });

      // 이미 로그인 되어 있으면 바로 이동
      const current = localStorage.getItem(`${APP_PREFIX}:currentUser`);
      if(current && current !== 'guest'){ goHome(); }
    })();
  </script>
</body>
</html>
